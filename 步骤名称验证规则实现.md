# 步骤名称验证规则实现

## 需求
步骤名称只能包含大小写字母、数字、下划线(_)、横线(-)，不允许中文和其他特殊字符。

## 实现内容

### 1. 后端验证 ✅

#### 自定义验证器
- **文件**: `internal/validator/validator.go`
- **验证器名称**: `alphanum_underscore_dash`
- **正则表达式**: `^[a-zA-Z0-9_-]+$`

#### 模型验证规则
- **文件**: `internal/model/step.go`
- **创建请求**: `binding:"required,min=1,max=128,alphanum_underscore_dash"`
- **更新请求**: `binding:"omitempty,min=1,max=128,alphanum_underscore_dash"`

#### 初始化
- **文件**: `cmd/web/main.go`
- **调用**: `validator.InitValidators()` 在服务启动时

### 2. 前端验证 ✅

#### 表单验证规则
- **文件**: `web/frontend/src/components/StepFormDialog.vue`
- **规则数组**:
  ```javascript
  name: [
    { required: true, message: '请输入步骤名称', trigger: 'blur' },
    { min: 1, max: 128, message: '步骤名称长度在1-128个字符', trigger: 'blur' },
    { pattern: /^[a-zA-Z0-9_-]+$/, message: '步骤名称只能包含字母、数字、下划线、横线', trigger: 'blur' }
  ]
  ```

## 测试验证

### ✅ 有效的步骤名称
- `test_step_name-123` ✅ 成功创建
- `test_step-name_123` ✅ 成功创建
- `MyStep123` ✅ 
- `step_1` ✅
- `api-gateway` ✅

### ❌ 无效的步骤名称
- `测试中文名称` ❌ 验证失败
- `test step with spaces` ❌ 验证失败（包含空格）
- `test@step#with$special%chars` ❌ 验证失败（包含特殊字符）

## 验证流程

1. **前端验证**: 用户输入时实时验证，表单提交前验证
2. **后端验证**: API接收请求时进行参数绑定验证
3. **错误处理**: 返回明确的错误信息指导用户修正

## 错误信息

### 前端错误信息
- `步骤名称只能包含字母、数字、下划线、横线`

### 后端错误信息  
- `Key: 'StepCreateRequest.Name' Error:Field validation for 'Name' failed on the 'alphanum_underscore_dash' tag`

## 技术实现细节

### 后端技术栈
- **验证框架**: go-playground/validator/v10
- **Web框架**: gin-gonic/gin
- **绑定方法**: ShouldBindJSON

### 前端技术栈
- **UI框架**: Ant Design Vue 3.0
- **表单验证**: 内置 form 组件验证
- **正则验证**: JavaScript 原生正则表达式

## 部署状态

- ✅ 后端服务已重新编译并重启
- ✅ 前端项目已重新构建
- ✅ 验证规则已生效并通过测试
- ✅ 双重验证确保数据完整性

## 兼容性说明

现有数据库中可能存在不符合新规则的旧步骤名称，但新创建和更新的步骤都会严格遵循此验证规则。